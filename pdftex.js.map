{"version":3,"file":"pdftex.js","sources":["src/pdftex.js"],"sourcesContent":["\nclass PdfTeXCompilation {\n  constructor () {\n    this._ready = false\n    this.worker = new Worker('./src/pdftex-worker.js') // TODO: move to server\n    this.ready = false\n    var self = this\n\n    this._eventListener = []\n\n    this.worker.addEventListener('message', function (event) {\n      var message = event.data\n      if (message.type === 'err' || message.type === 'log') {\n        self._fire(message.type, message.value)\n      } else if (message.type === 'finish') {\n        self._fire('finish', message.value)\n      } else if (message.type === 'ready') {\n        self._ready = true\n        self._fire('ready')\n      } else {\n        console.warn('Unexpected Worker response..', message)\n      }\n    })\n  }\n  _compile (source, options) {\n    var self = this\n    this.source = source\n    this._options = options || {}\n    if (options.debug) {\n      this.on('err', (err) => { console.error(err) })\n      this.on('log', (out) => { console.log(out) })\n    }\n    this.whenReady(function () {\n      self.worker.postMessage({ type: 'start', source: source })\n    })\n  }\n  // notifies event listeners\n  _fire(event, data) {\n    this._eventListener.forEach(l => {\n      if (l[0] === event) {\n        l[1](data)\n      }\n    })\n  }\n  // register an event listener\n  on (event, fn) {\n    this._eventListener.push([event, fn])\n  }\n  // stop the compilaten\n  terminate () {\n    this.worker.terminate()\n  }\n  whenReady (f) {\n    if (this._ready) {\n      f()\n    } else {\n      this.on('ready', f)\n    }\n  }\n}\n\nvar currentWorker = null\nvar nextWorker = new PdfTeXCompilation()\n\nexport default function pdftex (source, options) {\n  if (currentWorker != null) {\n    currentWorker.terminate()\n  }\n  currentWorker = nextWorker\n  nextWorker = new PdfTeXCompilation()\n\n  currentWorker._compile(source, options)\n  return currentWorker\n}"],"names":[],"mappings":";;;;;;AACA,MAAM,iBAAiB,CAAC;EACtB,WAAW,CAAC,GAAG;IACb,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;IACnB,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,wBAAwB,CAAC,CAAA;IAClD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;IAClB,IAAI,IAAI,GAAG,IAAI,CAAA;;IAEf,IAAI,CAAC,cAAc,GAAG,EAAE,CAAA;;IAExB,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,UAAU,KAAK,EAAE;MACvD,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAA;MACxB,IAAI,OAAO,CAAC,IAAI,KAAK,KAAK,IAAI,OAAO,CAAC,IAAI,KAAK,KAAK,EAAE;QACpD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,KAAK,CAAC,CAAA;OACxC,MAAM,IAAI,OAAO,CAAC,IAAI,KAAK,QAAQ,EAAE;QACpC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,KAAK,CAAC,CAAA;OACpC,MAAM,IAAI,OAAO,CAAC,IAAI,KAAK,OAAO,EAAE;QACnC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;QAClB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;OACpB,MAAM;QACL,OAAO,CAAC,IAAI,CAAC,8BAA8B,EAAE,OAAO,CAAC,CAAA;OACtD;KACF,CAAC,CAAA;GACH;EACD,QAAQ,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE;IACzB,IAAI,IAAI,GAAG,IAAI,CAAA;IACf,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;IACpB,IAAI,CAAC,QAAQ,GAAG,OAAO,IAAI,EAAE,CAAA;IAC7B,IAAI,OAAO,CAAC,KAAK,EAAE;MACjB,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,GAAG,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA,EAAE,CAAC,CAAA;MAC/C,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,GAAG,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA,EAAE,CAAC,CAAA;KAC9C;IACD,IAAI,CAAC,SAAS,CAAC,YAAY;MACzB,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAA;KAC3D,CAAC,CAAA;GACH;;EAED,KAAK,CAAC,KAAK,EAAE,IAAI,EAAE;IACjB,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,IAAI;MAC/B,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,EAAE;QAClB,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;OACX;KACF,CAAC,CAAA;GACH;;EAED,EAAE,CAAC,CAAC,KAAK,EAAE,EAAE,EAAE;IACb,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAA;GACtC;;EAED,SAAS,CAAC,GAAG;IACX,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAA;GACxB;EACD,SAAS,CAAC,CAAC,CAAC,EAAE;IACZ,IAAI,IAAI,CAAC,MAAM,EAAE;MACf,CAAC,EAAE,CAAA;KACJ,MAAM;MACL,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC,CAAA;KACpB;GACF;CACF;;AAED,IAAI,aAAa,GAAG,IAAI,CAAA;AACxB,IAAI,UAAU,GAAG,IAAI,iBAAiB,EAAE,CAAA;;AAExC,AAAe,SAAS,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE;EAC/C,IAAI,aAAa,IAAI,IAAI,EAAE;IACzB,aAAa,CAAC,SAAS,EAAE,CAAA;GAC1B;EACD,aAAa,GAAG,UAAU,CAAA;EAC1B,UAAU,GAAG,IAAI,iBAAiB,EAAE,CAAA;;EAEpC,aAAa,CAAC,QAAQ,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;EACvC,OAAO,aAAa;,;;,;;"}